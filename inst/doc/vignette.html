<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Filip Strnad, Simon Papalexiou, Yannis Markonis" />

<meta name="date" content="2019-05-08" />

<title>CoSMoS - A Complete Stochatic Modelling Solution</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">CoSMoS - A Complete Stochatic Modelling Solution</h1>
<h4 class="author">Filip Strnad, Simon Papalexiou, Yannis Markonis</h4>
<h4 class="date">2019-05-08</h4>


<div id="TOC">
<ul>
<li><a href="#section_1"><span class="toc-section-number">1</span> Step by step guide</a><ul>
<li><a href="#define-marginal-distribution"><span class="toc-section-number">1.1</span> Define marginal distribution</a></li>
<li><a href="#generate-uncorrelated-time-series"><span class="toc-section-number">1.2</span> Generate uncorrelated time series</a></li>
<li><a href="#autocorrelation"><span class="toc-section-number">1.3</span> Autocorrelation</a></li>
<li><a href="#intermittency"><span class="toc-section-number">1.4</span> Intermittency</a></li>
<li><a href="#validating-the-results"><span class="toc-section-number">1.5</span> Validating the results</a></li>
</ul></li>
<li><a href="#section_2"><span class="toc-section-number">2</span> Stochastic Simulation of real-world processes</a><ul>
<li><a href="#hourly-precipitation"><span class="toc-section-number">2.1</span> Hourly precipitation</a></li>
<li><a href="#daily-streamflow"><span class="toc-section-number">2.2</span> Daily streamflow</a></li>
</ul></li>
<li><a href="#section_3"><span class="toc-section-number">3</span> Available distributions in CoSMoS package</a><ul>
<li><a href="#burr-type-iii-distribution"><span class="toc-section-number">3.1</span> Burr type III distribution</a></li>
<li><a href="#burr-type-xii-distribution"><span class="toc-section-number">3.2</span> Burr type XII distribution</a></li>
<li><a href="#generalized-gamma-distribution"><span class="toc-section-number">3.3</span> Generalized gamma distribution</a></li>
<li><a href="#paretto-type-ii-distribution"><span class="toc-section-number">3.4</span> Paretto type II distribution</a></li>
</ul></li>
<li><a href="#references"><span class="toc-section-number">4</span> References</a></li>
</ul>
</div>

<hr />
<p><strong>Vignette with figures can be found <a href="http://rpubs.com/Strnda/CoSMoS">here</a>.</strong></p>
<hr />
<p><em>Hydroclimatic processes come in all “shapes and sizes”. They are characterized by different spatiotemporal correlation structures and probability distributions that can be continuous, mixed-type, discrete or even binary. Simulating such processes by reproducing precisely their marginal distribution and linear correlation structure, including features like intermittency, can greatly improve hydrological analysis and design. Traditionally, modelling schemes are case specific and typically attempt to preserve few statistical moments providing inadequate and potentially risky distribution approximations.</em></p>
<p><em>Here, a single framework is proposed that unifies, extends, and improves a general-purpose modelling strategy, based on the assumption that any process can emerge by transforming a specific “parent”&quot; Gaussian process. A novel mathematical representation of this scheme, introducing parametric correlation transformation functions, enables straightforward estimation of the parent-Gaussian process yielding the target process after the marginal back transformation, while it provides a general description that supersedes previous specific parameterizations, offering a simple, fast and efficient simulation procedure for every stationary process at any spatiotemporal scale.</em></p>
<p><em>This framework, also applicable for cyclostationary and multivariate modelling, is augmented with flexible parametric correlation structures that parsimoniously describe observed correlations. Real-world simulations of various hydroclimatic processes with different correlation structures and marginals, such as precipitation, river discharge, wind speed, humidity, extreme events per year, etc., as well as a multivariate example, highlight the flexibility, advantages, and complete generality of the method.</em></p>
<p>From <a href="https://doi.org/10.1016/j.advwatres.2018.02.013">Papalexiou (2018)</a>.</p>
<hr />
<div id="section_1" class="section level1">
<h1><span class="header-section-number">1</span> Step by step guide</h1>
<p>The implementation of the stochastic simulation framework follows a few simple steps. Our aim is to generate a time series from a given <a href="https://en.wikipedia.org/wiki/Marginal_distribution">marginal distribution</a>, <a href="https://en.wikipedia.org/wiki/Autocorrelation">autocorrelation function</a> and probability zero. The latter is the probability that a sample value is zero and is commonly used in modelling variables with a substantial number of zero values, such as daily precipitation (intermittent processes).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(CoSMoS)</code></pre></div>
<div id="define-marginal-distribution" class="section level2">
<h2><span class="header-section-number">1.1</span> Define marginal distribution</h2>
<p>Marginal distributions have different number of parameters and different type of parameters (location, scale, shape). For example, the <a href="https://en.wikipedia.org/wiki/Generalized_gamma_distribution">Generalized Gamma</a> distribution has one scale and two shape parameters, e.g., <code>margarg = list(scale = 2, shape1 = 0.9, shape2 = 0.8)</code>.</p>
<p>In general, CoSMoS supports all build-in distribution functions of <code>R</code> and of other packages, but also comes with some build-in distributions such as Generalized Gamma or Pareto type II. A list of the <code>CoSMoS</code> distributions with their parameters can be found in <a href="#section_3">Section 3</a>.</p>
<p>Hence, the first step of stochastic simulation with <code>CoSMoS</code> is to set the theoretical distribution that we will simulate, as well as its parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">marginaldist &lt;-<span class="st"> 'ggamma'</span>
param &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">scale =</span> <span class="dv">1</span>,
              <span class="dt">shape1 =</span> <span class="fl">.8</span>,
              <span class="dt">shape2 =</span> <span class="fl">.8</span>)</code></pre></div>
</div>
<div id="generate-uncorrelated-time-series" class="section level2">
<h2><span class="header-section-number">1.2</span> Generate uncorrelated time series</h2>
<p>The simplest case is to generate a time series (1000 values) with zero autocorrelation.</p>
<p>This can be done using the random generation <code>rggamma</code> (similarly to <code>rnorm</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">no &lt;-<span class="st"> </span><span class="dv">1000</span>
ggamma_sim &lt;-<span class="st"> </span><span class="kw">rggamma</span>(<span class="dt">n =</span> no, 
                      <span class="dt">scale =</span> <span class="dv">1</span>, 
                      <span class="dt">shape1 =</span> <span class="dv">1</span>, 
                      <span class="dt">shape2 =</span> <span class="fl">.5</span>)
<span class="kw">plot.ts</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">density</span>(ggamma_sim), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">acf</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
</div>
<div id="autocorrelation" class="section level2">
<h2><span class="header-section-number">1.3</span> Autocorrelation</h2>
<p>We can introduce the autocorrelation structure in two ways. Either by using specific lag autocorrelations as a list starting from lag 0 up to a desired lag, or by using a pre-defined parametric autocorrelation structure.</p>
<p>For instance, a time series with lag-1 autocorrelation <span class="math inline">\(\rho_1 = 0.8\)</span> can be generated by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acf &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>)
ggamma_sim &lt;-<span class="st"> </span><span class="kw">generateTS</span>(<span class="dt">n =</span> no,
                         <span class="dt">margdist =</span> marginaldist, 
                         <span class="dt">margarg =</span> param,
                         <span class="dt">acsvalue =</span> acf)
<span class="kw">plot</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">density</span>(ggamma_sim[[<span class="dv">1</span>]]), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">acf</span>(ggamma_sim[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p>Similarly, we can add more autocorrelation coeficients for a higher number of lags.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acf &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>) <span class="co">#up to lag-4</span>
ggamma_sim &lt;-<span class="st"> </span><span class="kw">generateTS</span>(<span class="dt">n =</span> no,
                         <span class="dt">margdist =</span> marginaldist, 
                         <span class="dt">margarg =</span> param,
                         <span class="dt">acsvalue =</span> acf)
<span class="kw">plot</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">density</span>(ggamma_sim[[<span class="dv">1</span>]]), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">acf</span>(ggamma_sim[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p>Another, more sophisticated approach is to use a function that creates the autocorrelation structure. This can be done be the <code>acs()</code> function or the user can create his own function. In the case of <code>acs()</code>, four types of autocorrelation functions are provided:</p>
<ul>
<li>Fractional Gaussian Noise (FGN)</li>
<li>Weibull</li>
<li>Pareto II (also known as Lomax)</li>
<li>Burr XII</li>
</ul>
<p>The <code>acs()</code> can produce values of the linear autocorrelation according to this four structures up to a desired lag. Thus, instead of setting each autocorrelation coefficient explicitly, we can fit a model with one to four arguments depending on the selected structure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## specify lag
lags &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">10</span>

## get the ACS
f &lt;-<span class="st"> </span><span class="kw">acs</span>(<span class="st">'fgn'</span>, <span class="dt">t =</span> lags, <span class="dt">H =</span> <span class="fl">.75</span>)
b &lt;-<span class="st"> </span><span class="kw">acs</span>(<span class="st">'burrXII'</span>, <span class="dt">t =</span> lags, <span class="dt">scale =</span> <span class="dv">1</span>, <span class="dt">shape1 =</span> <span class="fl">.6</span>, <span class="dt">shape2 =</span> <span class="fl">.4</span>)
w &lt;-<span class="st"> </span><span class="kw">acs</span>(<span class="st">'weibull'</span>, <span class="dt">t =</span> lags, <span class="dt">scale =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="fl">0.8</span>)
p &lt;-<span class="st"> </span><span class="kw">acs</span>(<span class="st">'paretoII'</span>, <span class="dt">t =</span> lags, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">shape =</span> <span class="fl">0.3</span>)

## visualize the ACS
dta &lt;-<span class="st"> </span><span class="kw">data.frame</span>(lags, f, b, w, p)

m.dta &lt;-<span class="st"> </span><span class="kw">melt</span>(dta, <span class="dt">id.vars =</span> <span class="st">'lags'</span>)

<span class="kw">ggplot</span>(m.dta,
       <span class="kw">aes</span>(<span class="dt">x =</span> lags,
           <span class="dt">y =</span> value,
           <span class="dt">group =</span> variable,
           <span class="dt">colour =</span> variable)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">2.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">lwd =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">'steelblue4'</span>, <span class="st">'red4'</span>, <span class="st">'green4'</span>, <span class="st">'darkorange'</span>),
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">'FGN'</span>, <span class="st">'Burr XII'</span>, <span class="st">'Weibull'</span>, <span class="st">'Pareto II'</span>),
                     <span class="dt">name =</span> <span class="st">''</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">bquote</span>(lag <span class="op">~</span><span class="st"> </span>tau),
       <span class="dt">y =</span> <span class="st">'Acf'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> t) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_grey</span>()</code></pre></div>
<p>Back to our example, we can implement a 30-lag autocorrelation structure as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">acf =<span class="st"> </span><span class="kw">acs</span>(<span class="dt">id =</span> <span class="st">'paretoII'</span>,
          <span class="dt">t =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">30</span>,
          <span class="dt">scale =</span> <span class="dv">1</span>,
          <span class="dt">shape =</span> <span class="fl">.75</span>)

ggamma_sim &lt;-<span class="st"> </span><span class="kw">generateTS</span>(<span class="dt">n =</span> no,
                         <span class="dt">margdist =</span> marginaldist, 
                         <span class="dt">margarg =</span> param,
                         <span class="dt">acsvalue =</span> acf)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p>Note that in this case we use only 2 parameters for autocorrelation and not 30, which increases our simulation parsimony. More details about the parametric autocorrelation structures can be found in section 3.2 in <a href="https://doi.org/10.1016/j.advwatres.2018.02.013">Papalexiou (2018)</a>.</p>
<p>Except for the four autocorrelation functions provided by <code>acs()</code>, we can also create the our own:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_acf &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">-2</span>, <span class="fl">-0.1</span>))
ggamma_sim &lt;-<span class="st"> </span><span class="kw">generateTS</span>(<span class="dt">n =</span> no,
                         <span class="dt">margdist =</span> marginaldist, 
                         <span class="dt">margarg =</span> param,
                         <span class="dt">acsvalue =</span> my_acf)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">acf</span>(ggamma_sim[[<span class="dv">1</span>]])</code></pre></div>
</div>
<div id="intermittency" class="section level2">
<h2><span class="header-section-number">1.4</span> Intermittency</h2>
<p>If we wish to simulate an intermittent process (e.g., precipitation), then we have to define the probability zero. For example, if <code>p0 = 0.9</code>, then generated data shall have 90% of zero values (dry days). In addition, we can simulate multiple processes at once by using argument <code>TSn = 5</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_zero &lt;-<span class="st"> </span><span class="fl">.9</span>
ggamma_sim &lt;-<span class="st"> </span><span class="kw">generateTS</span>(<span class="dt">n =</span> no, 
                         <span class="dt">margdist =</span> marginaldist,
                         <span class="dt">margarg =</span> param,
                         <span class="dt">acsvalue =</span> acf,
                         <span class="dt">p0 =</span> prob_zero,
                         <span class="dt">TSn =</span> <span class="dv">5</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(ggamma_sim, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
</div>
<div id="validating-the-results" class="section level2">
<h2><span class="header-section-number">1.5</span> Validating the results</h2>
<p>The efficiency of the generated time series can be validated with <code>checkTS()</code>. The first three moments, probability zero and the first three autocorrelation coefficients are printed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">checkTS</span>(ggamma_sim)</code></pre></div>
<hr />
</div>
</div>
<div id="section_2" class="section level1">
<h1><span class="header-section-number">2</span> Stochastic Simulation of real-world processes</h1>
<div id="hourly-precipitation" class="section level2">
<h2><span class="header-section-number">2.1</span> Hourly precipitation</h2>
<p>In practice, we usually want to simulate a natural process using some sampled time series. A typical hydroclimatic variable, also available in <code>CoSMoS</code> package is daily precipitation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">'precip'</span>)
<span class="kw">plot</span>(precip, <span class="dt">type =</span> <span class="st">'l'</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">density</span>(precip<span class="op">$</span>value), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="co">#Does not plot extreme values</span>
<span class="kw">acf</span>(precip<span class="op">$</span>value, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">lag.max =</span> <span class="dv">20</span>)</code></pre></div>
<p>To generate a synthetic time series with similar characteristics to the observed precipitation, we have to determine their marginal distribution, autocorrelation structure and probability zero for each individual month. This can be done by trying to fit various distributions and autocorrelation structures with <code>analyzeTS()</code> and then check the goodness-of-fit with <code>reportTS()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">precip_ggamma &lt;-<span class="st"> </span><span class="kw">analyzeTS</span>(<span class="dt">TS =</span> precip, 
                                   <span class="dt">season =</span> <span class="st">'month'</span>,
                                   <span class="dt">dist =</span> <span class="st">'ggamma'</span>,
                                   <span class="dt">acsID =</span> <span class="st">&quot;weibull&quot;</span>,
                                   <span class="dt">lag.max =</span> <span class="dv">12</span>)
<span class="kw">reportTS</span>(precip_ggamma, <span class="st">'dist'</span>)
<span class="kw">reportTS</span>(precip_ggamma, <span class="st">'acs'</span>)
<span class="kw">reportTS</span>(precip_ggamma, <span class="st">'stat'</span>)</code></pre></div>
<p>In this example, the Generalized Gamma distribution, with a Weibull auto-correlation structure, appears to fit well to the observered time series. Other combinations might not give so good results. For instance:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">precip_pareto &lt;-<span class="st"> </span><span class="kw">analyzeTS</span>(<span class="dt">TS =</span> precip, 
                                   <span class="dt">season =</span> <span class="st">'month'</span>,
                                   <span class="dt">dist =</span> <span class="st">'paretoII'</span>,
                                   <span class="dt">acsID =</span> <span class="st">'fgn'</span>,
                                   <span class="dt">lag.max =</span> <span class="dv">12</span>)
<span class="kw">reportTS</span>(precip_pareto, <span class="st">'dist'</span>)
<span class="kw">reportTS</span>(precip_pareto, <span class="st">'acs'</span>)</code></pre></div>
<p>When the marginal distribution and the autocorrelation structure with the best fit are determined, we can produce a synthetic time series with the same statistical properties with <code>simulateTS()</code> for a given period.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_precip &lt;-<span class="st"> </span><span class="kw">simulateTS</span>(<span class="dt">aTS =</span> precip_ggamma, 
                         <span class="dt">from =</span> <span class="kw">as.POSIXct</span>(<span class="st">'1978-12-01 00:00:00'</span>),
                         <span class="dt">to =</span> <span class="kw">as.POSIXct</span>(<span class="st">'2008-12-01 00:00:00'</span>))
dta &lt;-<span class="st"> </span>precip
dta[, id <span class="op">:</span><span class="er">=</span><span class="st"> 'observed'</span>]
sim_precip[, id <span class="op">:</span><span class="er">=</span><span class="st"> 'simulated'</span>]

dta &lt;-<span class="st"> </span><span class="kw">rbind</span>(dta, sim_precip)

<span class="kw">ggplot</span>(dta) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
</div>
<div id="daily-streamflow" class="section level2">
<h2><span class="header-section-number">2.2</span> Daily streamflow</h2>
<p>We can also apply the same methods to a different dataset - daily streamflow! For this example we have used random dataset from the MOPEX database <a href="https://www.nws.noaa.gov/oh/mopex/mo_datasets.htm">(https://www.nws.noaa.gov/oh/mopex/mo_datasets.htm)</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id &lt;-<span class="st"> '02135000'</span>
dta_raw &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(<span class="kw">read.fwf</span>(<span class="kw">sprintf</span>(
  <span class="st">'ftp://hydrology.nws.noaa.gov/pub/gcip/mopex/US_Data/Us_438_Daily/%s.dly'</span>, id), 
                                  <span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>),
                                  <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">'date'</span>, <span class="st">'P'</span>, <span class="st">'E'</span>, <span class="st">'value'</span>, <span class="st">'Tmax'</span>, <span class="st">'Tmin'</span>)))

dta_raw[, date <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">gsub</span>(<span class="st">' '</span>,<span class="st">'0'</span>, date), <span class="dt">format =</span> <span class="st">'%Y%m%d'</span>)]

daily_streamflow &lt;-<span class="st"> </span>dta_raw[value <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, .(date, value)]

str_burr &lt;-<span class="st"> </span><span class="kw">analyzeTS</span>(daily_streamflow,
                      <span class="dt">dist =</span> <span class="st">'ggamma'</span>,
                      <span class="dt">norm =</span> <span class="st">'N4'</span>,
                      <span class="dt">acsID =</span> <span class="st">'paretoII'</span>,
                      <span class="dt">lag.max =</span> <span class="dv">50</span>)

sim_str &lt;-<span class="st"> </span><span class="kw">simulateTS</span>(str_burr)

dta &lt;-<span class="st"> </span>daily_streamflow
dta[, id <span class="op">:</span><span class="er">=</span><span class="st"> 'observed'</span>]
sim_str[, id <span class="op">:</span><span class="er">=</span><span class="st"> 'simulated'</span>]

dta &lt;-<span class="st"> </span><span class="kw">rbind</span>(dta, sim_str)

<span class="kw">ggplot</span>(dta) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><strong>Recomended distributions for variables:</strong></p>
<ul>
<li><em>precipitation</em>: ggamma (Generalized Gamma), burr### (Burr type)<br />
</li>
<li><em>streamflow</em>: ggamma (Generalized Gamma), burr### (Burr type)<br />
</li>
<li><em>relative humidity</em>: beta<br />
</li>
<li><em>temperature</em>: norm (Normal distribution)</li>
</ul>
</div>
</div>
<div id="section_3" class="section level1">
<h1><span class="header-section-number">3</span> Available distributions in CoSMoS package</h1>
<p>Package CoSMoS supports majority of continuous distributions available in R with defined quantile and probability density functions. We also provide four widely used distributions - Burr type III and XII, Generalized gamma and Pareto type II distribution.</p>
<div id="burr-type-iii-distribution" class="section level2">
<h2><span class="header-section-number">3.1</span> Burr type III distribution</h2>
<p>distribution argument/name - burrIII<br />
parameters - list(scale, shape1, shape2)</p>
<p><span class="math display">\[f_{\text{BrIII}}(x)=\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}-1} \left(\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}}}{\gamma _1}+1\right){}^{-\gamma _1 \gamma _2-1}}{\beta } \\ F_{\text{BrIII}}(x)=\left(\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}}}{\gamma _1}+1\right){}^{-\gamma _1 \gamma _2} \\ Q_{\text{BrIII}}(u)=\beta  \left(\gamma _1 \left(u^{-\frac{1}{\gamma _1 \gamma _2}}-1\right)\right){}^{-\gamma _2} \\
m_{\text{BrIII}}(q)=\frac{\beta ^q \gamma _1^{\gamma _2 (-q)} \Gamma \left(\left(q+\gamma _1\right) \gamma _2\right) \Gamma \left(1-q \gamma _2\right)}{\Gamma \left(\gamma _1 \gamma _2\right)}\]</span></p>
</div>
<div id="burr-type-xii-distribution" class="section level2">
<h2><span class="header-section-number">3.2</span> Burr type XII distribution</h2>
<p>distribution argument/name - burrXII<br />
parameters - list(scale, shape1, shape2)</p>
<p><span class="math display">\[f_{\text{BrXII}}(x)=\frac{\left(\frac{x}{\beta }\right)^{\gamma _1-1} \left(\gamma _2 \left(\frac{x}{\beta }\right)^{\gamma _1}+1\right){}^{-\frac{1}{\gamma _1 \gamma _2}-1}}{\beta } \\
F_{\text{BrXII}}(x)=1-\left(\gamma _2 \left(\frac{x}{\beta }\right)^{\gamma _1}+1\right){}^{-\frac{1}{\gamma _1 \gamma _2}} \\ 
Q_{\text{BrXII}}(u)=\beta  \left(-\frac{1-(1-u)^{-\gamma _1 \gamma _2}}{\gamma _2}\right){}^{\frac{1}{\gamma _1}} \\
m_{\text{BrXII}}(q)=\frac{\beta ^q \gamma _2^{-\frac{q}{\gamma _1}-1} B\left(\frac{q+\gamma _1}{\gamma _1},\frac{1-q \gamma _2}{\gamma _1 \gamma _2}\right)}{\gamma _1}\]</span></p>
</div>
<div id="generalized-gamma-distribution" class="section level2">
<h2><span class="header-section-number">3.3</span> Generalized gamma distribution</h2>
<p>distribution argument/name - ggamma<br />
parameters - list(scale, shape1, shape2)</p>
<p><span class="math display">\[f_{\mathcal{G}\mathcal{G}}(x)=\frac{\gamma _2 e^{-\left(\frac{x}{\beta }\right)^{\gamma _2}} \left(\frac{x}{\beta }\right)^{\gamma _1-1}}{\beta  \Gamma \left(\frac{\gamma _1}{\gamma _2}\right)} \\
F_{\mathcal{G}\mathcal{G}}(x)=Q\left(\frac{\gamma _1}{\gamma _2},0,\left(\frac{x}{\beta }\right)^{\gamma _2}\right) \\ 
Q_{\mathcal{G}\mathcal{G}}(u)=\beta  Q^{-1}\left(\frac{\gamma _1}{\gamma _2},0,u\right){}^{\frac{1}{\gamma _2}} \\ 
m_{\mathcal{G}\mathcal{G}}(q)=\frac{\beta ^q \Gamma \left(\frac{q}{\gamma _2}+\frac{\gamma _1}{\gamma _2}\right)}{\Gamma \left(\frac{\gamma _1}{\gamma _2}\right)}\]</span></p>
</div>
<div id="paretto-type-ii-distribution" class="section level2">
<h2><span class="header-section-number">3.4</span> Paretto type II distribution</h2>
<p>distribution argument/name - burrIII<br />
parameters - list(scale, shape)</p>
<p><span class="math display">\[f_{\text{PII}}(x)=\frac{\left(\frac{\gamma  x}{\beta }+1\right)^{-\frac{1}{\gamma }-1}}{\beta } \\
F_{\text{PII}}(x)=1-\left(\frac{\gamma  x}{\beta }+1\right)^{-1/\gamma } \\
Q_{\text{PII}}(u)=\frac{\beta  \left((1-u)^{-\gamma }-1\right)}{\gamma } \\
m_{\text{PII}}(q)=\frac{\Gamma (q+1) \left(\frac{\beta }{\gamma }\right)^q \Gamma \left(\frac{1}{\gamma }-q\right)}{\Gamma \left(\frac{1}{\gamma }\right)}\]</span></p>
</div>
</div>
<div id="references" class="section level1">
<h1><span class="header-section-number">4</span> References</h1>
<p>Papalexiou, S.M., 2018. Unified theory for stochastic modelling of hydroclimatic processes: Preserving marginal distributions, correlation structures, and intermittency. Advances in Water Resources 115, 234-252. <a href="https://doi.org/10.1016/j.advwatres.2018.02.013">link</a></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
