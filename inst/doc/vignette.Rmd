---
title: "CoSMoS - A Complete Stochatic Modelling Solution"
author: "Filip Strnad, Simon Papalexiou"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
header-includes:
   - \usepackage{amsmath}
editor_options: 
  chunk_output_type: console
---

# Step by step guide
## Define marginal distribution
```{r, message = FALSE}
library(CoSMoS)

marginaldist <- 'burrXII'
para <- list(scale = 2,
             shape1 = .75,
             shape2 = .1)
```

## Define prob. zero
```{r}
p0 <- .9
```

## Define model order and target ACS
```{r}
order <- 100
targetcorr <- acfparetoII(t = 0:order, scale = 15, shape = .3)
```

## Calculate ACTI points
```{r}
p <- actpnts(marginaldist, para, p0 = p0)
```

## Fit the points
```{r}
f <- fitactf(p)
plot(f)
```

## Run the AR(p) model
```{r}
target <- ARp(margdist = marginaldist,
              margarg = para,
              actfpara = f,
              n = 100000,
              p0 = p0,
              p = order,
              acsvalue = targetcorr)
```

## Check the gaussian empirical + target transformed and the target process ACF
```{r, fig.show = 'hold'}
gauss <- attr(target, 'gaussian')

ggplot() +
  geom_point(aes(x = 0:order,
                 y = as.vector(acf(gauss, lag.max = order, plot = F)$acf)), colour = 'red2', alpha = .2) +
  geom_line(aes(x = 0:order,
                y = attr(target, 'trACS')), colour = 'red4') +
  theme_bw() +
  labs(x = 'Lag',
       y = 'ACF',
       title = 'Gaussian ACS')

ggplot() +
  geom_point(aes(x = 0:order,
                 y = as.vector(acf(target, lag.max = order, plot = F)$acf)), colour = 'steelblue2', alpha = .2) +
  geom_line(aes(x = 0:order,
                y = targetcorr), colour = 'steelblue4') +
  theme_bw() +
  labs(x = 'Lag',
       y = 'ACF',
       title = 'Target ACS')
```

## Check the simulation
```{r, comment = '>'}
checksimulation(target)
```

## Or check the model in general
```{r, out.width = '95%', fig.asp = .75, results = 'asis'}
chck <- checkmodel(margdist = marginaldist,
                   margarg = para,
                   n = 100000,
                   p = order,
                   p0 = p0,
                   acsvalue = targetcorr,
                   TSn = 15,
                   plot = T)

knitr::kable(chck)
```

# Available distributions in CoSMoS package

Package CoSMoS supports majority of continuous distributions available in R with defined quantile and probability density functions. We also provide four widely used distributions - Burr type III and XII, Generalized gamma and Pareto type II distribution.

## Burr type III distribution

distribution argument/name - burrIII    
parameters - list(scale, shape1, shape2)

$$f_{\text{BrIII}}(x)=\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}-1} \left(\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}}}{\gamma _1}+1\right){}^{-\gamma _1 \gamma _2-1}}{\beta } \\ F_{\text{BrIII}}(x)=\left(\frac{\left(\frac{x}{\beta }\right)^{-\frac{1}{\gamma _2}}}{\gamma _1}+1\right){}^{-\gamma _1 \gamma _2} \\ Q_{\text{BrIII}}(u)=\beta  \left(\gamma _1 \left(u^{-\frac{1}{\gamma _1 \gamma _2}}-1\right)\right){}^{-\gamma _2} \\
m_{\text{BrIII}}(q)=\frac{\beta ^q \gamma _1^{\gamma _2 (-q)} \Gamma \left(\left(q+\gamma _1\right) \gamma _2\right) \Gamma \left(1-q \gamma _2\right)}{\Gamma \left(\gamma _1 \gamma _2\right)}$$

## Burr type XII distribution

distribution argument/name - burrXII     
parameters - list(scale, shape1, shape2)

$$f_{\text{BrXII}}(x)=\frac{\left(\frac{x}{\beta }\right)^{\gamma _1-1} \left(\gamma _2 \left(\frac{x}{\beta }\right)^{\gamma _1}+1\right){}^{-\frac{1}{\gamma _1 \gamma _2}-1}}{\beta } \\
F_{\text{BrXII}}(x)=1-\left(\gamma _2 \left(\frac{x}{\beta }\right)^{\gamma _1}+1\right){}^{-\frac{1}{\gamma _1 \gamma _2}} \\ 
Q_{\text{BrXII}}(u)=\beta  \left(-\frac{1-(1-u)^{-\gamma _1 \gamma _2}}{\gamma _2}\right){}^{\frac{1}{\gamma _1}} \\
m_{\text{BrXII}}(q)=\frac{\beta ^q \gamma _2^{-\frac{q}{\gamma _1}-1} B\left(\frac{q+\gamma _1}{\gamma _1},\frac{1-q \gamma _2}{\gamma _1 \gamma _2}\right)}{\gamma _1}$$


## Generalized gamma distribution

distribution argument/name - ggamma    
parameters - list(scale, shape1, shape2)

$$f_{\mathcal{G}\mathcal{G}}(x)=\frac{\gamma _2 e^{-\left(\frac{x}{\beta }\right)^{\gamma _2}} \left(\frac{x}{\beta }\right)^{\gamma _1-1}}{\beta  \Gamma \left(\frac{\gamma _1}{\gamma _2}\right)} \\
F_{\mathcal{G}\mathcal{G}}(x)=Q\left(\frac{\gamma _1}{\gamma _2},0,\left(\frac{x}{\beta }\right)^{\gamma _2}\right) \\ 
Q_{\mathcal{G}\mathcal{G}}(u)=\beta  Q^{-1}\left(\frac{\gamma _1}{\gamma _2},0,u\right){}^{\frac{1}{\gamma _2}} \\ 
m_{\mathcal{G}\mathcal{G}}(q)=\frac{\beta ^q \Gamma \left(\frac{q}{\gamma _2}+\frac{\gamma _1}{\gamma _2}\right)}{\Gamma \left(\frac{\gamma _1}{\gamma _2}\right)}$$

## Paretto type II distribution

distribution argument/name - burrIII     
parameters - list(scale, shape)

$$f_{\text{PII}}(x)=\frac{\left(\frac{\gamma  x}{\beta }+1\right)^{-\frac{1}{\gamma }-1}}{\beta } \\
F_{\text{PII}}(x)=1-\left(\frac{\gamma  x}{\beta }+1\right)^{-1/\gamma } \\
Q_{\text{PII}}(u)=\frac{\beta  \left((1-u)^{-\gamma }-1\right)}{\gamma } \\
m_{\text{PII}}(q)=\frac{\Gamma (q+1) \left(\frac{\beta }{\gamma }\right)^q \Gamma \left(\frac{1}{\gamma }-q\right)}{\Gamma \left(\frac{1}{\gamma }\right)}$$

# References

Papalexiou, S.M., 2018. Unified theory for stochastic modelling of hydroclimatic processes: Preserving marginal distributions, correlation structures, and intermittency. Advances in Water Resources 115, 234-252. [link](https://doi.org/10.1016/j.advwatres.2018.02.013)
